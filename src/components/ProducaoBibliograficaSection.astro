---
import type { ProducaoBibliografica } from '../utils/personData';

interface Props {
  producao: ProducaoBibliografica;
}

const { producao } = Astro.props;

// Count total publications
const totalArtigos = producao?.artigos_periodicos?.length || 0;
const totalLivros = producao?.livros_publicados?.length || 0;
const totalCapitulos = producao?.capitulos_livros?.length || 0;
const totalCongressos = producao?.trabalhos_completos_congressos?.length || 0;

const hasProducao = totalArtigos > 0 || totalLivros > 0 || totalCapitulos > 0 || totalCongressos > 0;

// Sort articles by year (most recent first)
const artigosOrdenados = producao?.artigos_periodicos 
  ? [...producao.artigos_periodicos].sort((a, b) => b.ano - a.ano)
  : [];
---

{hasProducao && (
  <section class="producao-section" id="publicacoes">
    <h2>Produção Bibliográfica</h2>
    
    <div class="producao-summary">
      {totalArtigos > 0 && <span class="badge">Artigos: {totalArtigos}</span>}
      {totalLivros > 0 && <span class="badge">Livros: {totalLivros}</span>}
      {totalCapitulos > 0 && <span class="badge">Capítulos: {totalCapitulos}</span>}
      {totalCongressos > 0 && <span class="badge">Congressos: {totalCongressos}</span>}
    </div>

    {totalArtigos > 0 && (
      <div class="artigos-subsection">
        <h3>Artigos em Periódicos</h3>
        <div class="artigos-list">
          {artigosOrdenados.slice(0, 10).map((artigo, index) => {
            const artigoId = `artigo-${index}-${artigo.titulo.toLowerCase().replace(/[^a-z0-9]+/g, '-').substring(0, 50)}`;
            return (
            <article class="artigo" id={artigoId}>
              <h4>{artigo.titulo}</h4>
              <p class="autores">{artigo.autores}</p>
              <p class="revista">
                <strong>{artigo.revista}</strong>
                {artigo.volume && `, v. ${artigo.volume}`}
                {artigo.numero && `, n. ${artigo.numero}`}
                {artigo.paginas && `, p. ${artigo.paginas}`}
                {artigo.ano && `, ${artigo.ano}`}
              </p>
              {artigo.doi && (
                <p class="doi">
                  <a href={artigo.doi} target="_blank" rel="noopener noreferrer">
                    DOI: {artigo.doi}
                  </a>
                </p>
              )}
            </article>
          );
          })}
        </div>
        {totalArtigos > 10 && (
          <p class="more-info">Mostrando 10 de {totalArtigos} artigos</p>
        )}
      </div>
    )}
  </section>
)}

<style>
  .producao-section {
    margin: 2rem 0;
  }

  .producao-section h2 {
    margin: 0 0 1rem 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: #1a1a1a;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #0066cc;
  }

  .producao-summary {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  .badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: #e9ecef;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
    color: #495057;
  }

  .artigos-subsection {
    margin-top: 1.5rem;
  }

  .artigos-subsection h3 {
    margin: 0 0 1rem 0;
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
  }

  .artigos-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .artigo {
    padding: 1.25rem;
    background: #f8f9fa;
    border-left: 4px solid #dc3545;
    border-radius: 4px;
  }

  .artigo h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
    font-weight: 600;
    color: #1a1a1a;
    line-height: 1.4;
  }

  .artigo .autores {
    margin: 0 0 0.5rem 0;
    font-size: 0.9rem;
    color: #666;
    font-style: italic;
  }

  .artigo .revista {
    margin: 0 0 0.5rem 0;
    font-size: 0.9rem;
    color: #4a4a4a;
  }

  .artigo .doi {
    margin: 0;
    font-size: 0.85rem;
  }

  .artigo .doi a {
    color: #0066cc;
    text-decoration: none;
  }

  .artigo .doi a:hover {
    text-decoration: underline;
  }

  .more-info {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: #666;
    font-style: italic;
    text-align: center;
  }

  @media (max-width: 768px) {
    .producao-section h2 {
      font-size: 1.3rem;
    }

    .artigos-subsection h3 {
      font-size: 1.1rem;
    }

    .artigo {
      padding: 1rem;
    }

    .artigo h4 {
      font-size: 0.95rem;
    }
  }
</style>
